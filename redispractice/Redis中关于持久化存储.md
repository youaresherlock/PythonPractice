##### Redis中关于持久化存储

##### 流程:

```
1. 客户端向服务端发送写操作
2. 数据库客服务端接收到数据
3. 服务端调用write这个系统调用, 将数据写入磁盘
4. 操作系统将缓存区数据转入磁盘控制器
5. 然后将磁盘控制器的数据写入磁盘物理介质
```

##### 存储策略机制RDB

```
RDB也是快照持久化:
	指定是在指定间隔时间内将内存中的数据集快照写入磁盘, 是redis默认的存储持久化的方式
	这种方式将内存的数据以快照写入二进制文件中,默认文件名dump.rdb
	
RDB触发机制:
	save: 会阻塞当前服务器 执行save期间, redis不能执行其他命令,直到RDB过程完成为止
	bgsave: 后台异步进行快照操作, 快照同时可以响应客户端请求
	自动触发: 是配置文件完成, 设置触发存储的条件
	
RDB的优点:
	1. 文件紧凑,全量备份, 非常适用于进行备份和灾难恢复
	2. 生成RDB文件的时候 redis主进程会fork一个子进程来处理所有保存工作 主进程不需要进行I/O操作
	3. RDB恢复大数据集时速度比AOF恢复速度快
	
RDB缺点:
	因为RDB全量备份, 存储紧凑,并且使用子进程负责持久化,子进程拥有父进程数据,但是如果父进程数据修改, 进程之间不能共享全局变量,此时持久化期间修改的数据不会被保存,丢失数据
```

#####   存储策略机制AOF

```
AOF: 追加文件持久化
	redis会将每一个接收的写命令都通过国write函数追加到文件中, 通俗理解是日志记录

AOF触发机制:
	每修改同步always: 同步持久化 每次发生数据变更立即记录在磁盘,性能较差, 但是数据完整性比较好
	每秒同步everysec: 异步操作, 每秒记录如果一秒内宕机, 数据丢失
	不同no: 从不同步
	
AOF优点:
	1. 可以保护数据不丢失
	2. 日志文件没有磁盘地址开销, 写入性能非常高,文件不容易破损
	3. AOF日志文件过大时,出现后台重写操作,不会影响客户端读写
	4. AOF日志文件的命令通过非常刻度的方式进行记录,非常适合做灾难性误删除的紧急恢复
	
AOF缺点:
	1.对于同一份数据, AOF日志文件比RDB快照文件大
	2. AOF开启后,支持写每秒查询率比RDB支持的写每秒查询率低
	3. AOF发生过bug, 通过AOF记录的日志,进行数据恢复的时候,不能完整恢复
```

##### RDB和AOF对比

```
1. 启动优先级
	RDB低  AOF高
2. 体积
	RDB小  AOF大
3. 恢复速度
	RDB快  AOF慢
4. 数据安全性
	RDB丢数据  AOF根据策略决定
5. 轻重
	RDB重 AOF轻
```

